<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>태스크 참여/면제</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        .accepted {
            color: #008800;
            font-weight: bold;
        }
        .exempted {
            color: #ff6600;
            font-weight: bold;
        }
        .waiting {
            color: #0066cc;
            font-style: italic;
        }
        .btn-accept {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            margin-right: 5px;
            cursor: pointer;
        }
        .btn-exempt {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h2>내 태스크 참여/면제</h2>
    <p>잔여 티켓: <b>{{ remain }}</b></p>
    
    <h3>응답 대기 중인 태스크</h3>
    {% if assignments %}
    <table>
        <tr>
            <th>태스크명</th><th>설명</th><th>선정일시</th><th>액션</th>
        </tr>
        {% for a in assignments %}
        <tr>
            <td>{{ a.task.title }}</td>
            <td>{{ a.task.description }}</td>
            <td>{{ a.assigned_at.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>
                <form method="POST" style="display:inline;">
                    <input type="hidden" name="assignment_id" value="{{ a.id }}">
                    <input type="hidden" name="action" value="accept">
                    <button type="submit" class="btn-accept">태스크 수락</button>
                </form>
                
                {% if remain > 0 %}
                <form method="POST" style="display:inline;">
                    <input type="hidden" name="assignment_id" value="{{ a.id }}">
                    <input type="hidden" name="action" value="exempt">
                    <button type="submit" class="btn-exempt">티켓 사용(면제)</button>
                </form>
                {% else %}
                <span>(잔여 티켓 없음)</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>
    {% else %}
    <p>응답 대기 중인 태스크가 없습니다.</p>
    {% endif %}
    
    <h3>완료된 태스크</h3>
    {% if completed_assignments %}
    <table>
        <tr>
            <th>태스크명</th><th>설명</th><th>상태</th><th>선정일시</th>
        </tr>
        {% for a in completed_assignments %}
        <tr>
            <td>{{ a.task.title }}</td>
            <td>{{ a.task.description }}</td>
            <td class="{% if a.status == 'accepted' %}accepted{% else %}exempted{% endif %}">
                {% if a.status == 'accepted' %}
                    수락됨
                {% else %}
                    면제됨 (티켓 사용)
                {% endif %}
            </td>
            <td>{{ a.assigned_at.strftime('%Y-%m-%d %H:%M') }}</td>
        </tr>
        {% endfor %}
    </table>
    {% else %}
    <p>완료된 태스크가 없습니다.</p>
    {% endif %}
    
    <p><a href="/dashboard">대시보드로</a></p>
</body>
</html> 